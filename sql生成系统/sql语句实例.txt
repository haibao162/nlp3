SELECT
    cc.`name` AS 公司主体,
    t.detail_no AS 明细ID,
    b.payment_form_no AS 付款单编号,
    CONVERT(t.order_child_no USING utf8) AS 子订单编号,
    (
        SELECT GROUP_CONCAT(DISTINCT private_order.expenses_child)
        FROM bfis.bf_offline_payment_form_private_order private_order 
        WHERE t.payment_form_id = private_order.payment_form_id 
        GROUP BY t.payment_form_id
    ) AS 费用小类,
    CONVERT(t.project_name USING utf8) AS 项目名称（带备注）,
    (
        SELECT GROUP_CONCAT(DISTINCT project.name SEPARATOR ', ')
        FROM bfis.bf_offline_payment_form_private_order private_order 
        JOIN bfis.bf_offline_project project ON project.id = private_order.project_id
        WHERE private_order.payment_form_id = t.payment_form_id
    ) AS 项目名称去重（不带备注）,
    CONVERT(t.customer_name USING utf8) AS 客户名称,
    t.`name` AS 收款方姓名,
    t.card_no AS 身份证号,
    t.bank_no AS 收款账号,
    t.amount AS 金额,
    t.bank_ps AS 附言,
    t.mobile AS 手机号,
    t.bank_name AS 开户行,
    t.institution_code AS 收款机构编号,
    p.payer_name AS 付款方名称,
    p.payer_bank AS 付款方银行,
    p.payer_account AS 付款方账号,
    p.payer_ps AS 支付备注,
    t.pay_no AS 申请支付编号,
    CASE
        t.pay_type 
        WHEN '1' THEN '普通支付' 
        WHEN '2' THEN '被负冲' 
        WHEN '3' THEN '负冲' 
        ELSE '无' 
    END AS '支付方式',
    t.pay_start_time AS 发起支付时间,
    t.pay_time AS 支付完成时间,
    t.pay_serial_no AS 支付流水号,
    t.category_child AS 业务小类,
    t.create_time AS 创建时间 
FROM
    bfis.bf_offline_payment_form_private_detail t
    LEFT JOIN bfis.bf_offline_payment_pay_private p ON p.pay_no = t.pay_no
    INNER JOIN bfis.bf_offline_payment_form b ON t.payment_form_id = b.id 
    AND b.is_deleted = 0 
    AND b.payment_type = 2
    LEFT JOIN core_contract.corporation cc ON cc.id = t.corp_id 
WHERE
    t.is_deleted = 0 
    AND t.pay_state = '4' 
    AND t.pay_time >= CONCAT('2025-04-01', ' 00:00:00') 
    AND t.pay_time <= CONCAT('2025-04-30', ' 23:59:59')